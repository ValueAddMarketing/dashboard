<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAM CEO Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: { 900: '#0a0a0f', 800: '#12121a', 700: '#1a1a24', 600: '#22222e', 500: '#2a2a38' },
                        accent: { cyan: '#00d4ff', purple: '#a855f7', green: '#10b981', yellow: '#fbbf24', red: '#ef4444' }
                    },
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'], mono: ['monospace'] }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0a0a0f; color: #e5e5e5; }
        .gradient-text { background: linear-gradient(135deg, #00d4ff 0%, #a855f7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .card { background: linear-gradient(145deg, #12121a 0%, #1a1a24 100%); border: 1px solid rgba(255,255,255,0.05); }
        .card:hover { border-color: rgba(0, 212, 255, 0.3); }
        .scrollbar::-webkit-scrollbar { width: 6px; }
        .scrollbar::-webkit-scrollbar-thumb { background: #2a2a38; border-radius: 3px; }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const URLS = {
            clients: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRimOKUGksj-OVBSCpb9UGnkQU3Wu547GpcaUk4RT0oo5KM0fnVo2sk8mRpy4cwO5j9CckDORzmou-d/pub?gid=133498635&single=true&output=csv',
            days7: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRimOKUGksj-OVBSCpb9UGnkQU3Wu547GpcaUk4RT0oo5KM0fnVo2sk8mRpy4cwO5j9CckDORzmou-d/pub?gid=1447475730&single=true&output=csv',
            days30: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRimOKUGksj-OVBSCpb9UGnkQU3Wu547GpcaUk4RT0oo5KM0fnVo2sk8mRpy4cwO5j9CckDORzmou-d/pub?gid=1196243237&single=true&output=csv'
        };

        const pn = v => parseFloat(String(v||'0').replace(/[$,%]/g,'').replace(/,/g,''))||0;
        const fmt = v => '$'+(pn(v)).toLocaleString('en-US',{maximumFractionDigits:0});
        const fmtD = v => '$'+(pn(v)).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
        const fmtN = v => (pn(v)).toLocaleString('en-US',{maximumFractionDigits:0});

        const mapClient = r => ({
            client: r['Client']||'', state: r['State']||'', campaign: r['CAMPAIGN']||'',
            days: pn(r['Days Running']), spend: pn(r['Total Ad Spend']), leads: pn(r['Total Leads']),
            cpl: pn(r['Cost Per Lead']), appts: pn(r['Total Appts']), deals: pn(r['Potential Deals']), listings: pn(r['Listing'])
        });

        const mapCamp = r => ({
            account: r['Account name']||'', campaign: r['Campaign name']||'',
            cost: pn(r['Total Cost']), leads: pn(r['On Facebook Leads']), cpl: pn(r['Cost per On Facebook Leads'])
        });

        const getHealth = cpl => { if(!cpl) return 'Gray'; if(cpl<=25) return 'Green'; if(cpl<=50) return 'Yellow'; return 'Red'; };
        const healthColors = { Green:'bg-emerald-500', Yellow:'bg-amber-500', Red:'bg-red-500', Gray:'bg-gray-500' };
        const healthText = { Green:'text-emerald-400', Yellow:'text-amber-400', Red:'text-red-400', Gray:'text-gray-400' };

        const Badge = ({health}) => <span className={`px-2 py-0.5 rounded-full text-xs font-semibold ${healthColors[health]}/20 ${healthText[health]}`}>{health}</span>;

        const Card = ({title,value,sub,color='cyan'}) => (
            <div className={`card rounded-xl p-5 border-l-4 border-accent-${color}`}>
                <p className="text-gray-400 text-sm">{title}</p>
                <p className="text-2xl font-bold text-white mt-1">{value}</p>
                {sub && <div className="mt-2">{sub}</div>}
            </div>
        );

        const TimeCard = ({title,icon,data,color}) => {
            const t = useMemo(() => {
                const spend = data.reduce((s,r)=>s+r.cost,0);
                const leads = data.reduce((s,r)=>s+r.leads,0);
                return { spend, leads, cpl: leads>0?spend/leads:0, accounts: [...new Set(data.map(r=>r.account))].length };
            }, [data]);
            return (
                <div className={`card rounded-xl p-6 border-l-4 border-accent-${color}`}>
                    <div className="flex items-center gap-2 mb-4"><span className="text-2xl">{icon}</span><h3 className="text-lg font-semibold text-white">{title}</h3></div>
                    <div className="grid grid-cols-4 gap-4">
                        <div><div className="text-xl font-bold text-white">{fmt(t.spend)}</div><div className="text-xs text-gray-500">Spend</div></div>
                        <div><div className="text-xl font-bold text-accent-cyan">{fmtN(t.leads)}</div><div className="text-xs text-gray-500">Leads</div></div>
                        <div><div className="text-xl font-bold text-white">{fmtD(t.cpl)}</div><div className="text-xs text-gray-500">CPL</div></div>
                        <div><div className="text-xl font-bold text-accent-purple">{t.accounts}</div><div className="text-xs text-gray-500">Accounts</div></div>
                    </div>
                </div>
            );
        };

        const Trends = ({d7,d30}) => {
            const t7 = useMemo(() => ({ spend:d7.reduce((s,r)=>s+r.cost,0), leads:d7.reduce((s,r)=>s+r.leads,0) }), [d7]);
            const t30 = useMemo(() => ({ spend:d30.reduce((s,r)=>s+r.cost,0), leads:d30.reduce((s,r)=>s+r.leads,0) }), [d30]);
            const daily7 = { spend:t7.spend/7, leads:t7.leads/7, cpl:t7.leads>0?t7.spend/t7.leads:0 };
            const daily30 = { spend:t30.spend/30, leads:t30.leads/30, cpl:t30.leads>0?t30.spend/t30.leads:0 };
            const Tr = ({v,inv}) => { const g = inv?v<0:v>0; return <span className={Math.abs(v)<1?'text-gray-500':g?'text-emerald-400':'text-red-400'}>{v>0?'‚Üë':'‚Üì'} {Math.abs(v).toFixed(1)}%</span>; };
            return (
                <div className="card rounded-xl p-6">
                    <h3 className="text-lg font-semibold text-white mb-4">üìà 7-Day vs 30-Day Trends</h3>
                    <div className="space-y-3">
                        <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                            <span className="text-gray-400">Daily Spend</span>
                            <div className="text-right"><div className="text-white font-mono">{fmtD(daily7.spend)}/day</div><Tr v={daily30.spend>0?((daily7.spend-daily30.spend)/daily30.spend)*100:0}/></div>
                        </div>
                        <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                            <span className="text-gray-400">Daily Leads</span>
                            <div className="text-right"><div className="text-white font-mono">{daily7.leads.toFixed(1)}/day</div><Tr v={daily30.leads>0?((daily7.leads-daily30.leads)/daily30.leads)*100:0}/></div>
                        </div>
                        <div className="flex justify-between p-3 bg-dark-800 rounded-lg">
                            <span className="text-gray-400">CPL</span>
                            <div className="text-right"><div className="text-white font-mono">{fmtD(daily7.cpl)}</div><Tr v={daily30.cpl>0?((daily7.cpl-daily30.cpl)/daily30.cpl)*100:0} inv/></div>
                        </div>
                    </div>
                </div>
            );
        };

        const HealthBar = ({clients}) => {
            const d = useMemo(() => {
                const g=clients.filter(c=>getHealth(c.cpl)==='Green').length, y=clients.filter(c=>getHealth(c.cpl)==='Yellow').length;
                const r=clients.filter(c=>getHealth(c.cpl)==='Red').length, gr=clients.filter(c=>getHealth(c.cpl)==='Gray').length;
                return {g,y,r,gr,t:clients.length||1};
            }, [clients]);
            return (
                <div className="card rounded-xl p-6">
                    <h3 className="text-lg font-semibold text-white mb-4">Client Health</h3>
                    <div className="flex gap-1 h-4 rounded-full overflow-hidden mb-4">
                        {d.g>0&&<div className="bg-emerald-500" style={{width:`${d.g/d.t*100}%`}}/>}
                        {d.y>0&&<div className="bg-amber-500" style={{width:`${d.y/d.t*100}%`}}/>}
                        {d.r>0&&<div className="bg-red-500" style={{width:`${d.r/d.t*100}%`}}/>}
                        {d.gr>0&&<div className="bg-gray-500" style={{width:`${d.gr/d.t*100}%`}}/>}
                    </div>
                    <div className="grid grid-cols-4 text-center">
                        <div><div className="text-lg font-bold text-emerald-400">{d.g}</div><div className="text-xs text-gray-500">‚â§$25</div></div>
                        <div><div className="text-lg font-bold text-amber-400">{d.y}</div><div className="text-xs text-gray-500">$25-50</div></div>
                        <div><div className="text-lg font-bold text-red-400">{d.r}</div><div className="text-xs text-gray-500">$50+</div></div>
                        <div><div className="text-lg font-bold text-gray-400">{d.gr}</div><div className="text-xs text-gray-500">No Data</div></div>
                    </div>
                </div>
            );
        };

        const Alerts = ({clients,d7}) => {
            const red = clients.filter(c=>getHealth(c.cpl)==='Red').slice(0,3);
            const high7 = d7.filter(r=>r.cpl>50&&r.leads>0).slice(0,3);
            return (
                <div className="card rounded-xl p-6">
                    <h3 className="text-lg font-semibold text-white mb-4">üö® Alerts</h3>
                    <div className="space-y-2 max-h-64 overflow-y-auto scrollbar">
                        {high7.map((r,i)=><div key={i} className="bg-red-500/10 border border-red-500/30 rounded-lg p-3"><div className="text-red-400 font-semibold">{r.account}</div><div className="text-sm text-gray-400">7-Day CPL: {fmtD(r.cpl)}</div></div>)}
                        {red.map(c=><div key={c.client} className="bg-red-500/10 border border-red-500/30 rounded-lg p-3"><div className="text-red-400 font-semibold">{c.client}</div><div className="text-sm text-gray-400">CPL: {fmtD(c.cpl)}</div></div>)}
                        {high7.length===0&&red.length===0&&<div className="text-center py-4 text-gray-500">‚ú® All on track!</div>}
                    </div>
                </div>
            );
        };

        const Table = ({clients,sort,setSort}) => {
            const sorted = useMemo(() => {
                const s = [...clients];
                if(sort.k) s.sort((a,b) => { let av=a[sort.k],bv=b[sort.k]; if(typeof av==='string'){av=av.toLowerCase();bv=bv.toLowerCase();} return av<bv?(sort.d==='asc'?-1:1):av>bv?(sort.d==='asc'?1:-1):0; });
                return s;
            }, [clients,sort]);
            const TH = ({l,k}) => <th className="px-3 py-3 text-left text-xs font-semibold text-gray-400 uppercase cursor-pointer hover:text-white" onClick={()=>setSort({k,d:sort.k===k&&sort.d==='desc'?'asc':'desc'})}>{l} {sort.k===k&&<span className="text-accent-cyan">{sort.d==='asc'?'‚Üë':'‚Üì'}</span>}</th>;
            return (
                <div className="card rounded-xl overflow-hidden">
                    <div className="overflow-x-auto scrollbar">
                        <table className="w-full">
                            <thead className="bg-dark-800"><tr><TH l="Client" k="client"/><TH l="State" k="state"/><TH l="Days" k="days"/><TH l="Spend" k="spend"/><TH l="Leads" k="leads"/><TH l="CPL" k="cpl"/><TH l="Appts" k="appts"/><TH l="Deals" k="deals"/><th className="px-3 py-3 text-left text-xs font-semibold text-gray-400 uppercase">Health</th></tr></thead>
                            <tbody className="divide-y divide-dark-600">
                                {sorted.map(c=><tr key={c.client} className="hover:bg-dark-700/50"><td className="px-3 py-3 font-semibold text-white">{c.client}</td><td className="px-3 py-3 text-gray-400">{c.state}</td><td className="px-3 py-3 font-mono text-gray-300">{c.days}</td><td className="px-3 py-3 font-mono text-white">{fmt(c.spend)}</td><td className="px-3 py-3 font-mono text-accent-cyan">{fmtN(c.leads)}</td><td className="px-3 py-3 font-mono text-white">{fmtD(c.cpl)}</td><td className="px-3 py-3 font-mono text-accent-purple">{fmtN(c.appts)}</td><td className="px-3 py-3 font-mono text-accent-green">{fmtN(c.deals)}</td><td className="px-3 py-3"><Badge health={getHealth(c.cpl)}/></td></tr>)}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [clients, setClients] = useState([]);
            const [d7, setD7] = useState([]);
            const [d30, setD30] = useState([]);
            const [loading, setLoading] = useState(true);
            const [sort, setSort] = useState({k:'cpl',d:'desc'});
            const [filter, setFilter] = useState('all');
            const [search, setSearch] = useState('');

            useEffect(() => {
                Promise.all([
                    fetch(URLS.clients).then(r=>r.text()).then(csv=>{const lines=csv.split('\n');return Papa.parse(lines.slice(2).join('\n'),{header:true,skipEmptyLines:true}).data.map(mapClient).filter(r=>r.client);}).catch(()=>[]),
                    fetch(URLS.days7).then(r=>r.text()).then(csv=>Papa.parse(csv,{header:true,skipEmptyLines:true}).data.map(mapCamp).filter(r=>r.account)).catch(()=>[]),
                    fetch(URLS.days30).then(r=>r.text()).then(csv=>Papa.parse(csv,{header:true,skipEmptyLines:true}).data.map(mapCamp).filter(r=>r.account)).catch(()=>[])
                ]).then(([c,s7,s30])=>{ setClients(c); setD7(s7); setD30(s30); setLoading(false); });
            }, []);

            const filtered = useMemo(() => {
                let r = clients;
                if(filter!=='all') r = r.filter(c=>getHealth(c.cpl)===filter);
                if(search) r = r.filter(c=>c.client.toLowerCase().includes(search.toLowerCase()));
                return r;
            }, [clients,filter,search]);

            const totals = useMemo(() => {
                const spend=clients.reduce((s,c)=>s+c.spend,0), leads=clients.reduce((s,c)=>s+c.leads,0);
                return { spend, leads, cpl:leads>0?spend/leads:0, appts:clients.reduce((s,c)=>s+c.appts,0), deals:clients.reduce((s,c)=>s+c.deals,0) };
            }, [clients]);

            if(loading) return <div className="min-h-screen flex items-center justify-center text-4xl">‚è≥</div>;

            return (
                <div className="min-h-screen">
                    <header className="bg-dark-800/80 backdrop-blur border-b border-dark-600 sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
                            <div><h1 className="text-2xl font-bold gradient-text">VAM CEO Dashboard</h1><p className="text-sm text-gray-500">All Clients + Campaign Performance</p></div>
                            <a href="index.html" className="px-4 py-2 bg-dark-700 hover:bg-dark-600 text-gray-300 rounded-lg text-sm">‚Üê Client Hub</a>
                        </div>
                    </header>
                    <main className="max-w-7xl mx-auto px-6 py-8 space-y-8">
                        <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                            <Card title="Clients" value={clients.length} color="cyan"/>
                            <Card title="Total Spend" value={fmt(totals.spend)} color="purple"/>
                            <Card title="Total Leads" value={fmtN(totals.leads)} color="green"/>
                            <Card title="Avg CPL" value={fmtD(totals.cpl)} color="yellow" sub={<Badge health={getHealth(totals.cpl)}/>}/>
                            <Card title="Deals" value={fmtN(totals.deals)} color="green"/>
                        </div>
                        <div className="grid lg:grid-cols-2 gap-6">
                            <TimeCard title="Last 7 Days" icon="üìÖ" data={d7} color="cyan"/>
                            <TimeCard title="Last 30 Days" icon="üìÜ" data={d30} color="purple"/>
                        </div>
                        <div className="grid lg:grid-cols-3 gap-6">
                            <Trends d7={d7} d30={d30}/>
                            <HealthBar clients={clients}/>
                            <Alerts clients={clients} d7={d7}/>
                        </div>
                        <div className="flex flex-wrap gap-4">
                            <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Search clients..." className="flex-1 min-w-[200px] bg-dark-700 border border-dark-500 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-accent-cyan"/>
                            <div className="flex gap-2">{['all','Green','Yellow','Red'].map(f=><button key={f} onClick={()=>setFilter(f)} className={`px-4 py-2 rounded-lg text-sm ${filter===f?'bg-accent-cyan text-dark-900':'bg-dark-700 text-gray-400 hover:text-white'}`}>{f==='all'?'All':f}</button>)}</div>
                        </div>
                        <Table clients={filtered} sort={sort} setSort={setSort}/>
                    </main>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
    </script>
</body>
</html>
